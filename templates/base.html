{% load django_bootstrap5 %}
{% load static %}

<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block css %}{% endblock css %}
    {% block title %}{% endblock title %}
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    {% bootstrap_css %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">

  </head>

  <body>
    <!-- 네비게이션바 -->
    <nav style="background-color: #a4c3fa;" class="navbar navbar-expand-lg sticky-top" id="nabvar">
      <div class="container">
        <a class="navbar-brand" href="{% url 'labs:main' %}">
          <img src="{% static 'labs/img/mainlogo.png' %}" style="width: 44px; height:40px;" alt="">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between align-items-center" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="{% url 'communities:index' %}">커뮤니티</a>
            </li>
            <li class="nav-item " id="navbarProduct">
              <a class="nav-link text-black" href="{% url 'products:index' %}">제품</a>
            </li>
            <!-- 어드민만 보이는 회원목록 -->
            {% if request.user.is_superuser == 1 %}
              <li class="nav-item">
                <a class="nav-link" href="{% url 'accounts:index' %}">회원정보 목록</a>
              </li>
            {% endif %}
          </ul>

          <!-- 검색, 장바구니, 계정 -->
          <div class="d-flex">
            <lord-icon src="https://cdn.lordicon.com/msoeawqm.json" trigger="click" style="width:32px;height:32px" type="submit" id="search-click"></lord-icon>
            <a id="cart" class="nav-link mx-3" href="{% url 'cart:detail' %}">
              <img src="{% static 'img/cart_none.png' %}" alt="" width="25px" height="25px">
            </a>
            <div id="login">
              {% if request.user.is_authenticated %}
                <img src="{% static 'img/login_ing.png' %}" id="loginIng" alt="" width="30px" height="30px">
              {% else %}
                <img src="{% static 'img/login_none.png' %}" id="loginNone" class="" alt="" width="30px" height="30px">
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!--검색-->
    <div class="search-bg-black" id="searchForm" style="visibility: hidden; opacity: 0;">
      <div class="search-bg-white">
        <form class="search" action="{% url 'labs:search' %}">
          <input class="input_form" type="search" placeholder="검색" name="category" aria-label="Search" id="search" required="required">
          <button class="button" type="submit"><img src="https://cdn-icons-png.flaticon.com/512/16/16492.png" alt="검색 아이콘"></button>
        </form>
      </div>
      <div class="search-cancel"><img src="{% static 'img/cancel.png' %}" alt=""></div>
    </div>

    <!-- 프로필 (로그인) -->
    <div class="profile-black-bg-login">
      <div class="container">
        <div class="profile-bg-login">
          <div class="nav-user-login">
            <p class="nav-link mb-0 fw-bold">
              {% if request.user.image %}
                <img src="#" alt="" style="width: 30px; height: 28px; border-radius: 500px">
              {% endif %}
              <a href="#">{{ request.user }}님 안녕하세요!</a>
            </p>
            <hr>
            <div class="nav-detail-login">
              {% if request.user.is_authenticated %}
                <a class="nav-link" href="{% url 'accounts:detail' request.user.pk %}">회원정보 관리</a>
              {% endif %}
              <a class="nav-link" href="#">주문/배송 조회</a>
              <a class="nav-link" href="#">쿠폰존</a>
              <a class="nav-link" href="{% url 'accounts:logout' %}">로그아웃</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 프로필 (비로그인) -->
    <div class="profile-black-bg-none">
      <div class="container">
        <div class="profile-bg-none">
          <div class="nav-detail-none">
            <p class="nav-link mb-0 fw-bold">
              <a class="nav-link" href="{% url 'accounts:login' %}">로그인</a>
            </p>
            <a class="nav-link" href="{% url 'accounts:signup' %}">회원가입</a>
          </div>
        </div>
      </div>
    </div>

    <!-- 제품목록 -->
    <div class="black-bg">
      <div class="white-bg" id="listGroup">
        <div class="container">
          <div>
            <a href="{% url 'products:index' %}" class="navbar-product">전체</a>
          </div>
          <form action="{% url 'products:index' %}">
            <button type="submit" class="a_menu">
              <p>삼성 (Samsung)</p>
              <input type="text" value="삼성" class="category-value" name="category">
            </button>
          </form>
          <form action="{% url 'products:index' %}">
            <button type="submit" class="a_menu">
              <p>엘지 (LG)</p>
              <input type="text" value="LG전자" class="category-value" name="category">
            </button>
          </form>
          <form action="{% url 'products:index' %}">
            <button type="submit" class="a_menu">
              <p>애플 (Apple)</p>
              <input type="text" value="APPLE" class="category-value" name="category">
            </button>
          </form>
          <form action="{% url 'products:index' %}">
            <button type="submit" class="a_menu">
              <p>에이수스 (Asus)</p>
              <input type="text" value="ASUS" class="category-value" name="category">
            </button>
          </form>
          <form action="{% url 'products:index' %}">
            <button type="submit" class="a_menu">
              <p>레노버 (Lenovo)</p>
              <input type="text" value="레노버" class="category-value" name="category">
            </button>
          </form>
          <form action="{% url 'products:index' %}">
            <button type="submit" class="a_menu">
              <p>엠에스아이 (Msi)</p>
              <input type="text" value="MSI" class="category-value" name="category">
            </button>
          </form>
          <form action="{% url 'products:index' %}">
            <button type="submit" class="a_menu">
              <p>델 (Dell)</p>
              <input type="text" value="DELL" class="category-value" name="category">
            </button>
          </form>
          <form action="{% url 'products:index' %}">
            <button type="submit" class="a_menu">
              <p>한성 (Hansung)</p>
              <input type="text" value="한성" class="category-value" name="category">
            </button>
          </form>
          <form action="{% url 'products:index' %}">
            <button type="submit" class="a_menu">
              <p>기가바이트 (GigaByte)</p>
              <input type="text" value="GIGABYTE" class="category-value" name="category">
            </button>
          </form>
          <form action="{% url 'products:index' %}">
            <button type="submit" class="a_menu">
              <p>에이치피 (HP)</p>
              <input type="text" value="HP" class="category-value" name="category">
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- 타임특가정보 -->
    {% block timesale %}{% endblock timesale %}

    <!-- 캐러셀 -->
    {% block carousel %}{% endblock carousel %}

    <!-- 메인 내용 -->
    <main class="container">
      {% block content %}{% endblock content %}
    </main>

    <!-- 위/아래로 -->
    <div class='hamburger'>
      <img src="{% static 'img/ham.png' %}" alt="">
    </div>
    <div class='hamburger-click-x'>
      <img src="{% static 'img/x.png' %}" alt="">
    </div>
    <div class='hamburger-click-up'>
      <img src="{% static 'img/up.png' %}" alt="">
    </div>
    <div class='hamburger-click-down'>
      <img src="{% static 'img/down.png' %}" alt="">
    </div>

    <!-- 푸터1 -->
    <footer class="sticky-bottom">
      <div class="card">
        <div class="card-body text-center">
          made by. 유영, 호빈, 성인, 윤식, 창현
        </div>
      </div>
    </footer>

    <!-- 푸터2 -->
    <!-- <footer> <div>아이콘 출처 : <a href="https://www.flaticon.com/kr/free-animated-icons/" title="컴퓨터 애니메이션 아이콘">컴퓨터 애니메이션 아이콘 제작자: Freepik - Flaticon</a> </div> </footer> -->

    <!-- 스크립트 -->
    {% bootstrap_javascript %}
    <script src="https://cdn.lordicon.com/qjzruarw.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      const navbarProductClick = document.querySelector('#navbarProduct')
      const listGroup = document.querySelector("#listGroup")
      const nabvar = document.querySelector("#nabvar")
      const blackBg = document.querySelector('.black-bg')
      const profileBlackBgLogin = document.querySelector('.profile-black-bg-login')
      const profileBlackBgNone = document.querySelector('.profile-black-bg-none')
      const profileBgLogin = document.querySelector('.profile-bg-login')
      const profileBgNone = document.querySelector('.profile-bg-none')

      // 네비게이션바 제품
      navbarProductClick.addEventListener('mouseenter', () => {
        blackBg
          .classList
          .add('show-modal')
      })
      listGroup.addEventListener('mouseleave', () => {
        blackBg
          .classList
          .remove('show-modal')
      })
      nabvar.addEventListener('mouseover', () => {
        document
          .querySelector('.navbar')
          .style
          .backgroundColor = '#CCE1FF'
      })
      listGroup.addEventListener('mouseleave', () => {
        document
          .querySelector('.navbar')
          .style
          .backgroundColor = 'transparent'
      })

      if (login.children[0].id == 'loginNone') {
        // 비로그인 중 프로필 팝업
        const loginNone = document.querySelector('#loginNone')
        loginNone.addEventListener('mouseenter', () => {
          profileBlackBgNone.style.visibility = 'visible'
          profileBlackBgNone.style.opacity = '1'
        })
        profileBgNone.addEventListener('mouseleave', () => {
          profileBlackBgNone.style.visibility = 'hidden'
          profileBlackBgNone.style.opacity = '0'
        })
      } else {
        // 로그인 중 프로필 팝업
        const loginIng = document.querySelector('#loginIng')
        loginIng.addEventListener('mouseenter', () => {
          profileBlackBgLogin.style.visibility = 'visible'
          profileBlackBgLogin.style.opacity = '1'
        })
        profileBgLogin.addEventListener('mouseleave', () => {
          profileBlackBgLogin.style.visibility = 'hidden'
          profileBlackBgLogin.style.opacity = '0'
        })
      }

      // 검색
      const searchClick = document.querySelector("#search-click")
      const searchForm = document.querySelector('#searchForm')
      const searchCancel = document.querySelector('.search-cancel')

      searchClick.addEventListener('click', () => {
        if (searchForm.style.visibility == 'hidden') {
          searchForm.style.visibility = 'visible'
          searchForm.style.opacity = '1'
        } else {
          searchForm.style.visibility = 'hidden'
          searchForm.style.opacity = '0'
        }
      })

      searchCancel.addEventListener('click', () => {
        searchForm.style.visibility = 'hidden'
        searchForm.style.opacity = '0'
      })
    </script>

    <!-- 스크롤시 네비게이션바 투명하게 -->
    <script>
      const searchBtn = document.querySelector('#search-btn')

      window.addEventListener('scroll', () => {
        var 스크롤양 = document
          .querySelector('html')
          .scrollTop;
        var 실제높이 = document
          .querySelector('html')
          .scrollHeight;
        var 높이 = document
          .querySelector('html')
          .clientHeight;
        if (window.scrollY > 150) {
          document
            .querySelector('.navbar')
            .style
            .backgroundColor = 'transparent'
          document
            .querySelector('.navbar')
            .style
            .transition = 'all 1s'
        } else {
          document
            .querySelector('.navbar')
            .style
            .backgroundColor = '#CCE1FF'
          document
            .querySelector('.navbar')
            .style
            .transition = 'all 1s'
        }
      })
    </script>

    <script>
      const hamburger = document.querySelector('.hamburger')
      const hamburgerClickX = document.querySelector('.hamburger-click-x')
      const hamburgerClickUp = document.querySelector('.hamburger-click-up')
      const hamburgerClickDown = document.querySelector('.hamburger-click-down')

      hamburger.addEventListener('click', () => {
        hamburger.style.visibility = "hidden"
        hamburgerClickX.style.visibility = "visible"
        hamburgerClickUp.style.visibility = "visible"
        //hamburgerClickUp.style.opacity = '1'
        hamburgerClickUp.style.transform = "translateY(-260%)";
        hamburgerClickDown.style.visibility = "visible"
        //hamburgerClickDown.style.opacity = '1'
        hamburgerClickDown.style.transform = "translateY(-130%)";
      })

      hamburgerClickX.addEventListener('click', () => {
        hamburger.style.visibility = "visible"
        hamburgerClickX.style.visibility = "hidden"
        hamburgerClickUp.style.visibility = "hidden"
        hamburgerClickUp.style.transform = "translateY(0%)";
        hamburgerClickDown.style.visibility = "hidden"
        hamburgerClickDown.style.transform = "translateY(0%)";
      })

      hamburgerClickUp.addEventListener('click', () => {
        window.scrollTo({top: location, behavior: 'smooth'});
      })

      hamburgerClickDown.addEventListener('click', () => {
        window.scrollTo(0, document.body.scrollHeight);
      })
    </script>

    {% block js %}{% endblock js %}
  </body>

</html>
